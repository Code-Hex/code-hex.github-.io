<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/a96ad621d8cdc121.css" as="style"/><link rel="stylesheet" href="/_next/static/css/a96ad621d8cdc121.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-1ba851be9ba4c973.js" defer=""></script><script src="/_next/static/chunks/framework-5a8682ef9b01075e.js" defer=""></script><script src="/_next/static/chunks/main-aa46968682356127.js" defer=""></script><script src="/_next/static/chunks/pages/_app-99e8d11f162f5b5e.js" defer=""></script><script src="/_next/static/chunks/186-93a7616f12bea2a2.js" defer=""></script><script src="/_next/static/chunks/28-b8ac2766a83e3260.js" defer=""></script><script src="/_next/static/chunks/463-cf2c7e04c881272f.js" defer=""></script><script src="/_next/static/chunks/444-3f3380c0c0be6ab3.js" defer=""></script><script src="/_next/static/chunks/pages/note/tags/%5Btag%5D-fad5da8b8c127302.js" defer=""></script><script src="/_next/static/56e96580d96fc616e4d1183440d2ed3f6c4a59ac/_buildManifest.js" defer=""></script><script src="/_next/static/56e96580d96fc616e4d1183440d2ed3f6c4a59ac/_ssgManifest.js" defer=""></script><script src="/_next/static/56e96580d96fc616e4d1183440d2ed3f6c4a59ac/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="w-full mx-auto antialiased max-w-3xl xl:max-w-5xl"><div class="mx-8 sm:mx-10 md:mx-12 py-10"><main role="main" class="divide-y divide-gray-200"><div class="py-4"><h1 class="text-4xl tracking-tight font-extrabold text-gray-900"># terraform</h1><p class="mt-3 text-xl text-gray-500 sm:mt-4"><span class="text-pink-600">1</span> posts in<!-- --> <span class="font-bold text-black"># <!-- -->terraform</span></p></div><div aria-label="preview" class="mx-auto"><ul class="divide-y divide-gray-200"><li class="py-4"><div class="mb-4 pt-4"><div class="flex flex-col space-y-8"><div class="flex flex-col space-y-1"><div class="pt-1.5 flex justify-between items-center"><a role="link" href="/note/google_spf_dkim_dmarc/"><h2 class="text-2xl sm:text-3xl font-bold text-gray-900">取得したドメインで送信するメールの信頼性を上げる方法</h2></a></div><div class="text-sm sm:text-base whitespace-nowrap text-gray-500"><div class="sr-only">Published on</div><time dateTime="2021-12-19">December 19, 2021<!-- --> (<!-- -->4 months ago<!-- -->)</time></div><div aria-label="タグ一覧" class="flex flex-wrap gap-2"><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/terraform/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->terraform</span></a><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/gcp/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->gcp</span></a><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/email/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->email</span></a></div></div><div class="flex flex-col space-y-6"><div class="prose sm:prose-sm md:prose-md"><p>ドメインを取得後にそれを使ったメールアドレスで送信できるようになったが、受信先でそのメールが迷惑フォルダへ分類されることがある。</p>
<p>会社では Google Domain でドメインを取得後、Google Workspace を利用してメールを送信できるようになった。DNS の管理は Cloud DNS を利用していて、その設定は Terraform を用いて管理している。</p>
<p>当初の設定はシンプルなものであった。</p>
<ol>
<li>DNS ゾーンを設定</li>
<li>設定したゾーンに対して MX レコードを設定</li>
</ol>
<pre><code class="language-hcl">resource &quot;google_dns_managed_zone&quot; &quot;example_com_domain&quot; {
  name     = &quot;example-com&quot;
  dns_name = &quot;example.com.&quot;
}

# https://support.google.com/a/answer/9222085
resource &quot;google_dns_record_set&quot; &quot;example_com_email&quot; {
  name         = google_dns_managed_zone.example_com_domain.dns_name
  type         = &quot;MX&quot;
  ttl          = 300
  managed_zone = google_dns_managed_zone.example_com_domain.name
  rrdatas = [
    &quot;1 aspmx.l.google.com.&quot;,
    &quot;5 alt1.aspmx.l.google.com.&quot;,
    &quot;5 alt2.aspmx.l.google.com.&quot;,
    &quot;10 alt3.aspmx.l.google.com.&quot;,
    &quot;10 alt4.aspmx.l.google.com.&quot;,
  ]
}
</code></pre>
<p>これだけで取得したドメインを利用したアドレスでメールの送信ができる。しかし受信先の Gmail 上では次のような警告が表示されていた。</p>
<p><img src="https://user-images.githubusercontent.com/6500104/146682538-4be73b57-f202-4ad7-a47c-8316388e9149.png" alt="146682538-4be73b57-f202-4ad7-a47c-8316388e9149.png"/></p>
<p>これは Gmail 側で行われる認証ロジックによって、ドメインを取得した本人（もしくは法人）から送信されているメールかどうか判断できなかった場合に表示される。</p>
<p>本記事では Terraform で管理された Cloud DNS を例にメールの信頼性をどう向上させたのかを紹介していく。</p></div><div class="flex text-base font-medium"><a role="link" class="text-teal-600 hover:text-teal-700" aria-label="取得したドメインで送信するメールの信頼性を上げる方法の続きを読む" href="/note/google_spf_dkim_dmarc/">Read more →</a></div></div></div></div></li></ul></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"itemLinks":["/note/google_spf_dkim_dmarc"],"tag":"terraform"},"__N_SSG":true},"page":"/note/tags/[tag]","query":{"tag":"terraform"},"buildId":"56e96580d96fc616e4d1183440d2ed3f6c4a59ac","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>