<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><meta name="next-head-count" content="2"/><link rel="preload" href="/_next/static/css/1603687e8f7004d3.css" as="style"/><link rel="stylesheet" href="/_next/static/css/1603687e8f7004d3.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/_next/static/chunks/webpack-829f202eac0b6556.js" defer=""></script><script src="/_next/static/chunks/framework-f24ee7685564395e.js" defer=""></script><script src="/_next/static/chunks/main-d8da880aeb2604cd.js" defer=""></script><script src="/_next/static/chunks/pages/_app-6aba51fb4d7298d5.js" defer=""></script><script src="/_next/static/chunks/541-9470330e8c8d1998.js" defer=""></script><script src="/_next/static/chunks/281-9b50af9f13ce79b8.js" defer=""></script><script src="/_next/static/chunks/pages/note/tags/%5Btag%5D-a315db0dc0203a56.js" defer=""></script><script src="/_next/static/9f12e43818ecd65896127fa981871ecd4d198ca1/_buildManifest.js" defer=""></script><script src="/_next/static/9f12e43818ecd65896127fa981871ecd4d198ca1/_ssgManifest.js" defer=""></script><script src="/_next/static/9f12e43818ecd65896127fa981871ecd4d198ca1/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><div class="w-full mx-auto antialiased max-w-3xl xl:max-w-5xl"><div class="mx-8 sm:mx-10 md:mx-12 py-10"><main class="divide-y divide-gray-200"><div class="py-4"><h1 class="text-4xl tracking-tight font-extrabold text-gray-900"># email</h1><p class="mt-3 text-xl text-gray-500 sm:mt-4"><span class="text-pink-600">1</span> posts in<!-- --> <span class="font-bold text-black"># <!-- -->email</span></p></div><div class="mx-auto"><ul class="divide-y divide-gray-200"><li class="py-4"><div class="mb-4 pt-4"><div class="flex flex-col space-y-8"><div class="flex flex-col space-y-1"><div class="pt-1.5 flex justify-between items-center"><a href="/note/google_spf_dkim_dmarc/"><h2 class="text-2xl sm:text-3xl font-bold text-gray-900">取得したドメインで送信するメールの信頼性を上げる方法</h2></a></div><div class="text-sm sm:text-base whitespace-nowrap text-gray-500"><div class="sr-only">Published on</div><time dateTime="2021-12-19">December 19, 2021<!-- --> (<!-- -->3 days ago<!-- -->)</time></div><div class="flex space-x-2 py-2"><a class="inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/terraform/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->terraform</span></a><a class="inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/gcp/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->gcp</span></a><a class="inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/email/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->email</span></a></div></div><div class="flex flex-col space-y-6"><div class="prose sm:prose-sm md:prose-md"><p>ドメインを取得後にそれを使ったメールアドレスで送信できるようになったが、受信先でそのメールが迷惑フォルダへ分類されることがある。</p><p>会社では Google Domain でドメインを取得後、Google Workspace を利用してメールを送信できるようになった。DNS の管理は Cloud DNS を利用していて、その設定は Terraform を用いて管理している。</p><p>当初の設定はシンプルなものであった。</p><ol><li>DNS ゾーンを設定</li><li>設定したゾーンに対して MX レコードを設定</li></ol><pre><code class="language-hcl">resource &quot;google_dns_managed_zone&quot; &quot;example_com_domain&quot; {
  name     = &quot;example-com&quot;
  dns_name = &quot;example.com.&quot;
}

# https://support.google.com/a/answer/9222085
resource &quot;google_dns_record_set&quot; &quot;example_com_email&quot; {
  name         = google_dns_managed_zone.example_com_domain.dns_name
  type         = &quot;MX&quot;
  ttl          = 300
  managed_zone = google_dns_managed_zone.example_com_domain.name
  rrdatas = [
    &quot;1 aspmx.l.google.com.&quot;,
    &quot;5 alt1.aspmx.l.google.com.&quot;,
    &quot;5 alt2.aspmx.l.google.com.&quot;,
    &quot;10 alt3.aspmx.l.google.com.&quot;,
    &quot;10 alt4.aspmx.l.google.com.&quot;,
  ]
}
</code></pre><p>これだけで取得したドメインを利用したアドレスでメールの送信ができる。しかし受信先の Gmail 上では次のような警告が表示されていた。</p><p><img src="https://user-images.githubusercontent.com/6500104/146682538-4be73b57-f202-4ad7-a47c-8316388e9149.png" alt="146682538-4be73b57-f202-4ad7-a47c-8316388e9149.png"/></p><p>これは Gmail 側で行われる認証ロジックによって、ドメインを取得した本人（もしくは法人）から送信されているメールかどうか判断できなかった場合に表示される。</p><p>本記事では Terraform で管理された Cloud DNS を例にメールの信頼性をどう向上させたのかを紹介していく。</p></div><div class="flex text-base font-medium"><a class="text-teal-600 hover:text-teal-700" aria-label="取得したドメインで送信するメールの信頼性を上げる方法" href="/note/google_spf_dkim_dmarc/">Read more →</a></div></div></div></div></li></ul></div></main></div></div></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"itemLinks":["/note/google_spf_dkim_dmarc"],"tag":"email"},"__N_SSG":true},"page":"/note/tags/[tag]","query":{"tag":"email"},"buildId":"9f12e43818ecd65896127fa981871ecd4d198ca1","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>