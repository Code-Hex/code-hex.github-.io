<!DOCTYPE html><html lang="ja"><head><meta charSet="utf-8"/><title>Slack から Discord へ移行した - アルパカの徒然文</title><meta name="description" content="Slack のフリープランだと 90 日分しかメッセージを保存できなくなってしまうので Discord へ移行しました。"/><link rel="canonical" href="https://codehex.dev/note/slack2discord"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:site" content="@codehex"/><meta property="og:url" content="https://codehex.dev/note/slack2discord"/><meta property="og:title" content="Slack から Discord へ移行した - アルパカの徒然文"/><meta property="og:image" content="https://codehex.dev/assets/images/a1f25eebf0bdb28f5f53977d18d8adaa.png"/><meta property="og:description" content="Slack のフリープランだと 90 日分しかメッセージを保存できなくなってしまうので Discord へ移行しました。"/><meta property="og:type" content="article"/><meta name="viewport" content="width=device-width, initial-scale=1"/><meta name="next-head-count" content="12"/><script async="" src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8097329174824434" crossorigin="anonymous"></script><link rel="preload" href="/_next/static/css/cb05f45700160405.css" as="style"/><link rel="stylesheet" href="/_next/static/css/cb05f45700160405.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/_next/static/chunks/polyfills-0d1b80a048d4787e.js"></script><script src="/_next/static/chunks/webpack-fecce247ebec0a1a.js" defer=""></script><script src="/_next/static/chunks/framework-0ba0ddd33199226d.js" defer=""></script><script src="/_next/static/chunks/main-3e1f83e356353203.js" defer=""></script><script src="/_next/static/chunks/pages/_app-29c235e094f245c1.js" defer=""></script><script src="/_next/static/chunks/186-81857d9b3c3c717c.js" defer=""></script><script src="/_next/static/chunks/55-8174b7f62ba27649.js" defer=""></script><script src="/_next/static/chunks/327-407bbdfad760cb5f.js" defer=""></script><script src="/_next/static/chunks/pages/note/slack2discord-8c15216799b5ab08.js" defer=""></script><script src="/_next/static/96f780db3780a124eb0a19f2d66cb92c7afa5e70/_buildManifest.js" defer=""></script><script src="/_next/static/96f780db3780a124eb0a19f2d66cb92c7afa5e70/_ssgManifest.js" defer=""></script></head><body><div id="__next"><main role="main" class="w-full mx-auto max-w-3xl xl:max-w-5xl"><div class="w-full bg-white antialiased"><div class="mx-8 sm:mx-10 md:mx-12 pt-10 pb-16"><div class="pb-2 border-b border-gray-200 mb-10"><h1 class="inline-block text-3xl font-bold text-gray-900 tracking-tight">Slack から Discord へ移行した</h1><div class="text-sm sm:text-base whitespace-nowrap text-gray-500"><div class="sr-only">Published on</div><time dateTime="2022-08-02T13:36:48+09:00">August 02, 2022<!-- --> (<!-- -->6 months ago<!-- -->)</time></div><div aria-label="タグ一覧" class="flex flex-wrap gap-2"><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/slack/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->slack</span></a><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/discord/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->discord</span></a><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/Go/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->Go</span></a><a role="link" class="w-max inline-flex rounded-sm bg-blue-100 hover:bg-blue-600 px-2 py-0.5 text-sm" href="/note/tags/golang/"><span class="font-medium text-blue-700 hover:text-white"># <!-- -->golang</span></a></div></div><article role="article" class="prose sm:prose-sm md:prose-md"><p><a href="https://codehex.dev/slack_invitation/">Join code-hex workspace on Slack.</a> から入れる。自分の学習した内容だったり、メモ、何かしらのスニペットを雑に投稿するための Slack を運営していた。</p>
<p>Slack へ投稿しておくことで、後で自分が見返したくなった時に検索機能を利用して情報を引っ張ってくるのにとても便利だった。また他人のツイートに関して、その URL を投稿しておくことでオリジナルが削除されても、スナップショットとしても残るので便利だった。</p>
<p>しかし 2022 年 9 月 1 日から Slack のフリープランの内容が改定されることになった。<a href="https://slack.com/intl/ja-jp/help/articles/7050776459923-%E3%83%97%E3%83%AD%E3%83%97%E3%83%A9%E3%83%B3%E3%81%AE%E6%96%99%E9%87%91%E6%94%B9%E5%AE%9A%E3%81%A8%E3%83%95%E3%83%AA%E3%83%BC%E3%83%97%E3%83%A9%E3%83%B3%E3%81%AE%E6%9C%80%E6%96%B0%E6%83%85%E5%A0%B1#u12501u12522u12540u12503u12521u12531u12395u38306u12377u12427u12424u12367u12354u12427u36074u21839">フリープランの変更に関するよくある質問</a>によると、ワークスペースにある 90 日が経過したメッセージやファイルのデータは全て非表示になり、有料プランへアップグレードしなければアクセスできなくなってしまう。
これでは今まで投稿したコンテンツを見返せなくなってしまうため、<a href="https://discord.com/">Discord</a> への移行を決めた。</p>
<p>ここではどう移行したかその内容を記録をする。</p>
<h2 id="slack-のワークスペースの状況"><a href="#slack-%E3%81%AE%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E7%8A%B6%E6%B3%81" aria-hidden="true" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></a>Slack のワークスペースの状況</h2>
<p>冒頭で紹介した通り、誰でも私の個人 Slack へ参加することは可能だった。しかし幸い(？)なことに私以外の発言はほとんどなかった。</p>
<p>このワークスペースではいくつかチャンネルがあり、私が興味を持ったカテゴリごとに作成していた。それぞれのチャンネルには私の独り言が投稿されている状況だった。</p>
<p><code>#status-feed</code> というチャンネルも存在した。ここでは GCP や GitHub といった自分がよく使うサービスのインシデント情報のフィードを収集していた。</p>
<p>作成したチャンネルへ投稿するだけでなく、自分宛の DM も活用していた。そこではパブリックにできないメモを送信していた。</p>
<h2 id="discord-へ移行する"><a href="#discord-%E3%81%B8%E7%A7%BB%E8%A1%8C%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></a>Discord へ移行する</h2>
<p>移行する要件は次のように決定した。</p>
<ul>
<li>投稿は私だけなので、Discord でも私が投稿したと分かるようにする<!-- -->
<ul>
<li>私のアカウントとして Slack で投稿していたメッセージを Discord へ投稿すればいい</li>
</ul>
</li>
<li>Discord へ投稿されるメッセージはシンプルなものにする<!-- -->
<ul>
<li>URL は Discord 側が OGP の情報を使って立地に表示してくれることを期待する</li>
</ul>
</li>
<li>メッセージがいつのものか把握できるようにする</li>
<li>チャンネルも同じものを用意する</li>
</ul>
<p>細かい中身は都度調整するば良いので早速手を動かし始める。</p>
<p>まず最初に行ったのは既存の移行ツールを探すことである。「Slack2Discord」とかで GitHub を検索するといくつかヒットするが、ほとんどが要件を満たせそうにもなかったので諦めた。<sup><a href="#user-content-fn-1" id="user-content-fnref-1" data-footnote-ref="true" aria-describedby="footnote-label">1</a></sup></p>
<p>そこで簡単なスクリプトを自分で書くことにした。そのコードは私の <a href="https://gist.github.com/Code-Hex/e1f78e63ebe71ffc1d7b20453c088fab">Gist</a> に投稿した。</p>
<h3 id="slack-ワークスペースの投稿データを集める"><a href="#slack-%E3%83%AF%E3%83%BC%E3%82%AF%E3%82%B9%E3%83%9A%E3%83%BC%E3%82%B9%E3%81%AE%E6%8A%95%E7%A8%BF%E3%83%87%E3%83%BC%E3%82%BF%E3%82%92%E9%9B%86%E3%82%81%E3%82%8B" aria-hidden="true" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></a>Slack ワークスペースの投稿データを集める</h3>
<p>先に Slack 上のメッセージを引いてくるコードを書いた。<a href="https://api.slack.com/methods/conversations.history">conversations.history</a> と呼ばれる、チャンネル ID を指定するとその ID 内のメッセージを取得できる API を使った。Gist では <code>history</code> 関数がその部分である。
ワークスペースに参加しているメンバーでワイワイできるチャンネルはチャンネル ID が <code>C...</code> ものになる。冒頭で紹介したように DM も取得したかったため <code>D...</code> のようなチャンネル ID も指定できるようにする必要があった。</p>
<p>Slack にはいくつか API Token の種類が存在し、自身の DM を含めたメッセージも取得したいなら <a href="https://api.slack.com/authentication/token-types#user">User Token (xoxp-)</a> を利用することが必須であった。</p>
<p>Your Apps &gt; OAuth &amp; Permissions &gt; User Token Scopes で必要なスコープを選択して設定を保存をすると User Token を取得できる。</p>
<p><img src="https://user-images.githubusercontent.com/6500104/182142857-36e45207-8284-4c3c-a02d-df15824479bb.png" alt="OAuth Scope では channels:history と im:history を指定する必要がある。"/></p>
<p>どんな内容を取得できるか確認するために全てのメッセージをターミナルへ出力観察した。するとやはり意図しないメッセージが含まれていることに気がついた。</p>
<ul>
<li>***さんがチャンネルに参加しました</li>
<li>***がこのチャンネルの説明を...</li>
<li>リンクを含んだメッセージだと特殊なフォーマットとしてリンクが含まれている<!-- -->
<ul>
<li><code>&lt;https://badpuns.example.com/puns/123&gt;</code> だったり <code>&lt;badpans|https://badpuns.example.com/puns/123&gt;</code> だったりする</li>
</ul>
</li>
</ul>
<p>Slack が勝手に投稿するような不要なメッセージは無視するようにコードを書き直した。リンクを含んだメッセージは、稀にリンクテキスト（https://~ で始まるものではなく、テキストにリンクが紐づいてるもの）として表示されるものもあるが、そのテキストは無視してリンクの URL だけをそのまま展開するように修正した。</p>
<p>API は <code>1648392833.619319</code> のような投稿された時のタイムスタンプ（<code>ts</code>）も返してくれる。これは非常に重要で Discord へ投稿処理を行う前にターミナルへ出力しておくことで途中から再開することが可能になる。<sup><a href="#user-content-fn-2" id="user-content-fnref-2" data-footnote-ref="true" aria-describedby="footnote-label">2</a></sup></p>
<p>冒頭で紹介した要件を満たすために Gist のコードでは <code>ts2time</code> 関数でタイムスタンプを整形してメッセージへ連結するようにしている。</p>
<h3 id="discord-へ投稿する"><a href="#discord-%E3%81%B8%E6%8A%95%E7%A8%BF%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></a>Discord へ投稿する</h3>
<p>これは非常にシンプルで、私自身としてメッセージを投稿するようにすれば良い。</p>
<p>そこでログイン中のアカウントが使用している Authorization Token を取得する必要があり、その方法は「<a href="https://shunshun94.github.io/shared/sample/discordAccountToken">Discord の自分のアカウントの Token を取得しよう！</a>」を参考にした。</p>
<p><a href="https://github.com/bwmarrin/discordgo">github.com/bwmarrin/discordgo</a> というパッケージを利用すると簡単に投稿できた。以下はメッセージを投稿するだけのサンプルである。ここでも Discord のチャンネル ID を指定する必要がある。</p>
<pre><code class="language-go">apiToken := &quot;...&quot; // 取得してきたもの
discordChannel := &quot;...&quot; // チャンネル ID
session, err := discordgo.New(apiToken)
if err != nil {
	return err
}
_, err = session.ChannelMessageSend(discordChannel, m.Text)
if err != nil {
	return fmt.Errorf(&quot;failed to send message: %w&quot;, err)
}
</code></pre>
<p>Discord のチャンネルにカーソルを合わせて「Copy Link」を選択するとこのような URL を取得できる。URL は <code>://discord.com/channels/.../1003504711648936078</code> のようになり、この <code>1003504711648936078</code> の部分がチャンネル ID になる。</p>
<p>ある程度動いたことを確認したら、Gist のコードのように <code>history</code> 関数で取得した Slack のメッセージを Discord へ投稿するように修正した。取得した DM は Discord でプライベートチャンネルを作成し、そこに投稿することにした。</p>
<p>あとはスクリプトを実行して待つだけである。実行指定みた感じ、Discord 側でもメッセージを受け付ける Ratelimit が存在するっぽく、まあまあ時間がかかったので気長に待つつもりで取り掛かった方が良い。</p>
<h3 id="discord-でフィードを収集する"><a href="#discord-%E3%81%A7%E3%83%95%E3%82%A3%E3%83%BC%E3%83%89%E3%82%92%E5%8F%8E%E9%9B%86%E3%81%99%E3%82%8B" aria-hidden="true" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></a>Discord でフィードを収集する</h3>
<p>Slack では標準で RSS のインテグレーションが存在したが、なんと Discord には存在しなかった。そこで調べてみるとどうやら <a href="https://github.com/synzen/MonitoRSS">MonitoRSS</a> と呼ばれるオープンソースで開発されている bot をインストールすることで解決できた。</p>
<p><a href="https://monitorss.xyz/">MonitoRSS のページ</a>から設定できる。</p>
<p><img src="https://user-images.githubusercontent.com/6500104/182300585-9fef17ac-d841-4795-9e10-9ef076955819.png" alt="Control Panel と Invite Me! のボタンが存在するので、それぞれをクリックして設定を行う"/></p>
<p>先に <code>Invite Me!</code> をクリックして bot の invite を行う。次に <code>Control Panel</code> ボタンをクリックするとフィードの設定を行うことができる。無料プランだと 5 件までフィードを登録することが可能らしい。</p>
<p>フィードも追加して無事に動いてることが確認できたため、移行作業は完了とした。</p>
<h2 id="移行後"><a href="#%E7%A7%BB%E8%A1%8C%E5%BE%8C" aria-hidden="true" tabindex="-1"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13.828 10.172a4 4 0 00-5.656 0l-4 4a4 4 0 105.656 5.656l1.102-1.101m-.758-4.899a4 4 0 005.656 0l4-4a4 4 0 00-5.656-5.656l-1.1 1.1"></path></svg></a>移行後</h2>
<p>移行して 2 日目だが良い感じに稼働しているように思える。Discord に慣れていることもあるせいか特に不満はない。強いて言うなら GIF 形式のリアクションを追加するのは有料プラン（<a href="https://discord.com/nitro">Discord Nitro</a>）へ加入する必要がある点だけだろう。（私個人は別に問題ない）</p>
<p>今回私が行ったことが誰かの参考になることを期待してこの記事を書いた。</p>
<details><summary>メモチャンネルの様子</summary><img width="998" alt="スクリーンショット 2022-08-02 14 50 25" src="https://user-images.githubusercontent.com/6500104/182301523-b2eaeb63-2930-4a67-afe4-040b27870201.png"/></details>
<details><summary>フィードチャンネルの様子</summary><img width="998" alt="スクリーンショット 2022-08-02 14 50 42" src="https://user-images.githubusercontent.com/6500104/182301538-4edb0e91-c735-41ed-9b55-ecbc63d225cb.png"/></details>
<!-- -->
<section data-footnotes="true" class="footnotes"><h2 id="footnote-label" class="sr-only">Footnotes</h2>
<ol>
<li id="user-content-fn-1">
<p>移行完了した後に「<a href="https://www.takameron.info/post/slack_dump/">Slackのメッセージをバックアップ</a>」という良さそうな記事を見つけた。ここで紹介されている <code>slack-dump</code> と呼ばれるツールを使うことも検討できたかもしれない。 <a href="#user-content-fnref-1" data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
<li id="user-content-fn-2">
<p>Slack API も <a href="https://api.slack.com/methods/conversations.history#pagination-by-time"><code>oldest</code> パラメータへ指定することでそのメッセージから返してくれるらしい</a>が、なぜか順序が期待しないものになったため、自身のプログラムで処理するようにした。おそらく Slack APi のバグ。 <a href="#user-content-fnref-2" data-footnote-backref="true" class="data-footnote-backref" aria-label="Back to content">↩</a></p>
</li>
</ol>
</section></article><div aria-label="SNSで共有する" class="flex space-x-2 mt-8"><a href="https://b.hatena.ne.jp/entry/s/codehex.dev/note/slack2discord" class="w-16 max-h-6 rounded-sm border border-blue-400" target="_blank" rel="noopener noreferrer" role="link" aria-label="Hatena Bookmarkで共有する"><div class="w-full flex justify-between items-center"><span class="bg-blue-400 hover:bg-blue-500 text-white text-sm font-bold py-px px-1">B!</span><span class="w-full text-center text-gray-600 text-sm hover:bg-blue-100 hover:bg-opacity-50">0</span></div></a><a href="https://twitter.com/intent/tweet?text=Slack%20%E3%81%8B%E3%82%89%20Discord%20%E3%81%B8%E7%A7%BB%E8%A1%8C%E3%81%97%E3%81%9F&amp;url=https://codehex.dev/note/slack2discord" class="flex items-center w-20 rounded-sm bg-blue-400 hover:bg-blue-500" target="_blank" rel="noopener noreferrer" role="link" aria-label="Twitterで共有する"><div class="px-2 w-full flex justify-between items-center"><svg version="1.1" id="Logo" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" class="w-4 h-4" viewBox="0 0 248 204" xml:space="preserve"><g id="Logo_1_"><path id="white_background" fill="#fff" d="M221.95,51.29c0.15,2.17,0.15,4.34,0.15,6.53c0,66.73-50.8,143.69-143.69,143.69v-0.04 C50.97,201.51,24.1,193.65,1,178.83c3.99,0.48,8,0.72,12.02,0.73c22.74,0.02,44.83-7.61,62.72-21.66 c-21.61-0.41-40.56-14.5-47.18-35.07c7.57,1.46,15.37,1.16,22.8-0.87C27.8,117.2,10.85,96.5,10.85,72.46c0-0.22,0-0.43,0-0.64 c7.02,3.91,14.88,6.08,22.92,6.32C11.58,63.31,4.74,33.79,18.14,10.71c25.64,31.55,63.47,50.73,104.08,52.76 c-4.07-17.54,1.49-35.92,14.61-48.25c20.34-19.12,52.33-18.14,71.45,2.19c11.31-2.23,22.15-6.38,32.07-12.26 c-3.77,11.69-11.66,21.62-22.2,27.93c10.01-1.18,19.79-3.86,29-7.95C240.37,35.29,231.83,44.14,221.95,51.29z"></path></g></svg><span class="text-white text-xs font-bold py-px px-1">Tweet</span></div></a></div></div></div></main><footer role="contentinfo" class="w-full mx-auto max-w-3xl xl:max-w-5xl"><div class="text-md font-medium leading-5 divide-y divide-gray-200"><div class="mx-8 sm:mx-10 md:mx-12 pb-24 lg:pb-16"><a role="link" class="text-teal-600 hover:text-teal-700" href="/note/">← Back to the note</a></div></div></footer></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"ogpPath":"/assets/images/a1f25eebf0bdb28f5f53977d18d8adaa.png","bookmarkCount":"0"},"__N_SSG":true},"page":"/note/slack2discord","query":{},"buildId":"96f780db3780a124eb0a19f2d66cb92c7afa5e70","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>